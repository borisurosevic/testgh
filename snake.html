<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Gamedev Canvas Workshop</title>
        <style>
            * { padding: 0; margin: 0; }
            canvas { background: #eee; display: block; margin: auto; margin-top: 20px; }
        </style>
    </head>
    <body>
        <canvas id="myCanvas" width="480" height="320"></canvas>
    </body>
</html>

<script>
    let canvas = document.getElementById("myCanvas");
    let ctx = canvas.getContext("2d");

    //let snakePositions = new Array([30, 60], [40, 60], [50, 60], [60, 60], [70,60], [80,60], [90,60], [100,60], [110,60], [120,60], [130,60], [140,60], [150,60], [160,60], [170,60], [180,60]);
    let snakePositions = new Array([30, 60], [40, 60], [50, 60]);

    let pixel = 10;
    let move = 10;

    let foodX = getFoodX();
    let foodY = getFoodY();
    let eatFood = false;

    let direction = 'right';
    let pressedKeys = new Array();
    let pressed = 'rightPressed';

    let score = 0;
    let game_over = false;

    function drawSnake(){

        for( let i = 0; i < snakePositions.length; i++ ){
            snakeX = snakePositions[i][0];
            snakeY = snakePositions[i][1];

            if ( snakeX > canvas.width-pixel ){
                snakeX = 0;
            }
            if( snakeX < 0 ){
                snakeX = canvas.width-pixel;
            }
            if( snakeY > canvas.height-pixel ){
                snakeY = 0;
            }
            if( snakeY < 0 ){
                snakeY = canvas.height-pixel;
            }

            snakePositions[i][0] = snakeX;
            snakePositions[i][1] = snakeY;

            ctx.beginPath();
            ctx.rect(snakeX, snakeY, pixel, pixel);
            ctx.fillStyle = "green";
            ctx.fill();
            ctx.closePath();
        }

        pressed = pressedKeys.length == 0 ? pressed : pressedKeys[0];
        pressedKeys.shift()

        if( pressed == 'rightPressed' && direction != 'left' ){
            direction = 'right';
        }else if( pressed == 'leftPressed' && direction != 'right' ){
            direction = 'left';
        }else if( pressed == 'upPressed' && direction != 'down' ){
            direction = 'up';
        }else if( pressed == 'downPressed' && direction != 'up' ){
            direction = 'down';
        }

        switch(direction){
            case 'right':
                snakeX += move;
                break;
            case 'left':
                snakeX -= move;
                break;
            case 'up':
                snakeY -= move;
                break;
            case 'down':
                snakeY += move;
                break;
        }

        for( let i = 0; i < snakePositions.length; i++ ){
            if(snakePositions[i][0] == snakeX && snakePositions[i][1] == snakeY){
                alert('GAME OVER');
                game_over = true;
            }
        }

        if( game_over ){
            resetGame();
        }else{
            snakePositions.push([snakeX, snakeY]);
            if( !eatFood ){
                snakePositions.shift();
            }
            eatFood = false;
        }
    }

    function drawFood(){
        last_element = snakePositions.length-1;
        snakeX = snakePositions[last_element][0]
        snakeY = snakePositions[last_element][1];



// HRANA DA NE BUDE U TELU ZMIJE



        if( snakeX == foodX && snakeY == foodY ){
            foodX = getFoodX();
            foodY = getFoodY();

            eatFood = true;
            score++;
        }

        ctx.beginPath();
        ctx.rect(foodX, foodY, pixel, pixel);
        ctx.fillStyle = "blue";
        ctx.fill();
        ctx.closePath();
    }

    function drawScore(){
        ctx.font = "16px Arial";
        ctx.fillStyle = "#0095DD";
        ctx.fillText("Score: " + score, 8, 20);
    }

    function draw(){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        drawSnake();
        drawFood();
        drawScore();

        //requestAnimationFrame(draw);
        setTimeout(function(){ draw(); }, 125);
    }


    function getFoodX(){
        let rand = Math.random();
        let foodX = Math.floor(rand * canvas.width) - Math.floor(rand * canvas.width)%pixel;

        return foodX;
    }

    function getFoodY(){
        let rand = Math.random();
        let foodY = Math.floor(rand * canvas.height) - Math.floor(rand * canvas.height)%pixel;

        return foodY;
    }

    function resetGame(){
        pressedKeys.length = 0;
        snakePositions.length = 0;
        snakePositions = [[30, 60], [40, 60], [50, 60]];
        score = 0;
        game_over = false;
        pressed = 'rightPressed';
    }

    document.addEventListener("keydown", keyDownHandler, false);

    function keyDownHandler(e){
        if( !game_over && (e.key == "Right" || e.key == "ArrowRight") ){
            if( pressedKeys[pressedKeys.length-1] != 'rightPressed' && pressedKeys[pressedKeys.length-1] != 'leftPressed' ){
                pressedKeys.push('rightPressed');
            }
        }else if( e.key == "Left" || e.key == "ArrowLeft" ){
            if( pressedKeys[pressedKeys.length-1] != 'leftPressed' && pressedKeys[pressedKeys.length-1] != 'rightPressed' ){
                pressedKeys.push('leftPressed');
            }
        }else if( e.key == "Up" || e.key == "ArrowUp" ){
            if( pressedKeys[pressedKeys.length-1] != 'upPressed' && pressedKeys[pressedKeys.length-1] != 'downPressed' ){
                pressedKeys.push('upPressed');
            }
        }else if( e.key == "Down" || e.key == "ArrowDown" ){
            if( pressedKeys[pressedKeys.length-1] != 'downPressed' && pressedKeys[pressedKeys.length-1] != 'upPressed' ){
                pressedKeys.push('downPressed');
            }
        }
    }

    draw();
    
</script>